<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
        crossorigin="" />
    <!-- leaflet scriptfiles -->
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
        crossorigin=""></script>

    <title>leaflet test</title>
</head>

<body>

    <div class="container">
        <div class=jumbotron>
            <form>

                <div class="form">
                    <label for="latitude">Latitude</label>
                    <input type="text" class="form" id="latitude">
                </div>

                <div class="form">
                    <label for="longitude">Longitude</label>
                    <input type="text" class="form" id="longitude">
                </div>

                <button type="submit" id="button" class="btn btn-primary">Submit</button>
            </form>
        </div>
        <p>testing the "https://api.wheretheiss.at/v1/satellites/25544"

            this api returns the current ISS location - just press submit - it pulls its location automatically then
            spits the coordinates into a Leaflet map.

        </p>

        <br>
        <hr>
        <div class="container">
            <div class="wrapper">

                <div id="latitudeN"> </div>
                <div id="longitudeN"> </div>
                <div id="altitude"> </div>
                <div id="velocity"> </div>
                <div id="visibility"> </div>
            </div>
        </div>
        <br>
        <div id=mapBox>
            <div id="mapid" ></div>

            <br>
            <br>
            <br>
        </div>
    </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
        crossorigin=""></script>
    <script type="text/javascript">


        var latitude = "";
        var longitude = "";
        var altitude = "";
        var velocity = "";
        var mymap = null;
        

        $("#button").on("click", function (event) {
            event.preventDefault();
            if (mymap !== null) mymap.remove();

            var queryURL = "https://api.wheretheiss.at/v1/satellites/25544"

            $.ajax({
                url: queryURL,
                method: "GET"
            })

                .then(function (response) {
                    console.log(response);

                    console.log(response.latitude)
                    console.log(response.longitude)


                    var altitude = response.altitude;
                    var velocity = response.velocity;
                    var visibility = response.visibility;
                    var latitude = response.latitude;
                    var longitude = response.longitude;


                    var altitudeN = altitude.toFixed(2);
                    var velocityN = velocity.toFixed(2);
                    var latitudeN = latitude.toFixed(4);
                    var longitudeN = longitude.toFixed(4);

                    $("#latitudeN").text("Latitude: " + latitudeN),
                        $("#longitudeN").text("Longitude: " + longitudeN),
                        $("#altitude").text("Altitude: " + altitudeN + "    Miles above the Earth"),
                        $("#velocity").text("Velocity: " + velocityN + "    MPH")
                    $("#visibility").text("Visibility: " + visibility)

                     mymap = L.map('mapid').setView([latitudeN, longitudeN], 20);


                    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
                        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                        maxZoom: 3,
                        id: 'mapbox.streets',
                        accessToken: 'pk.eyJ1IjoicG1hY2s5OSIsImEiOiJjam1zNXh4c2owMGc5M3dwN2ZjeWloc2t5In0.OJ_GGAfAJgMK0OCnN2NbhA'
                    }).addTo(mymap);

                    L.marker([latitudeN, longitudeN]).addTo(mymap)
                        .bindPopup('The ISS')
                        .openPopup();

                        map.panTo([latitudeN, longitudeN], animate=true);

                       


                });

                 setTimeout(moveIss, 3000);
        })



    </script>



    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
</body>

</html>